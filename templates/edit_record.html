<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UR Laptop System - Edit Record</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’»</text></svg>">
    <style>
        /* ===== CSS VARIABLES ===== */
        :root {
            --primary-blue: #0066cc;
            --secondary-blue: #004d99;
            --light-blue: #e6f2ff;
            --dark-gray: #333;
            --medium-gray: #666;
            --light-gray: #f5f5f5;
            --white: #fff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --radius: 8px;
            --transition: all 0.3s ease;
        }

        /* ===== RESET & BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--dark-gray);
            background: linear-gradient(135deg, var(--light-blue) 0%, #f8f9fa 100%);
            min-height: 100vh;
        }

        /* ===== CONTAINER ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ===== FLASH MESSAGES ===== */
        .flash-messages {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 1000;
            max-width: calc(100% - 40px);
        }

        .flash {
            padding: 15px 25px;
            margin-bottom: 10px;
            border-radius: var(--radius);
            color: white;
            animation: slideIn 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-width: 300px;
            max-width: 100%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            word-wrap: break-word;
        }

        .flash.success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            border-left: 4px solid #1e9e3e;
        }

        .flash.danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
            border-left: 4px solid #bd2130;
        }

        .flash.info {
            background: linear-gradient(135deg, var(--primary-blue) 0%, #0056b3 100%);
            border-left: 4px solid #004d99;
        }

        .flash.warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e0a800 100%);
            border-left: 4px solid #d39e00;
        }

        .flash button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            opacity: 0.8;
            transition: var(--transition);
            padding: 0 5px;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .flash button:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* ===== DASHBOARD CONTAINER ===== */
        .dashboard-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER ===== */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .welcome-message h1 {
            color: var(--primary-blue);
            font-size: clamp(18px, 5vw, 24px);
        }

        .welcome-message p {
            color: var(--medium-gray);
            font-size: clamp(12px, 3vw, 14px);
        }

        /* ===== MENU TOGGLE ===== */
        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--primary-blue);
            cursor: pointer;
            padding: 10px;
            border-radius: var(--radius);
            transition: var(--transition);
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .menu-toggle:hover {
            background-color: var(--light-blue);
            transform: rotate(90deg);
        }

        /* ===== NAVIGATION MENU ===== */
        .nav-menu {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100vh;
            background: var(--white);
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            z-index: 1000;
            transition: var(--transition);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .nav-menu.active {
            left: 0;
        }

        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: none;
        }

        .menu-header {
            padding: 20px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .menu-header h3 {
            color: var(--primary-blue);
            font-size: 18px;
            margin-bottom: 5px;
        }

        .menu-header p {
            color: var(--medium-gray);
            font-size: 14px;
        }

        .menu-items {
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            color: var(--dark-gray);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: 500;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 15px;
        }

        .menu-item:hover {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            transform: translateX(5px);
        }

        .menu-item.active {
            background-color: var(--primary-blue);
            color: white;
        }

        .menu-item i {
            margin-right: 15px;
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .menu-footer {
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            padding: 40px 20px;
        }

        /* ===== EDIT FORM CONTAINER ===== */
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--white);
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .form-header {
            margin-bottom: 30px;
            text-align: center;
        }

        .form-header h2 {
            color: var(--primary-blue);
            margin-bottom: 10px;
            font-size: clamp(20px, 5vw, 24px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .form-header p {
            color: var(--medium-gray);
            font-size: clamp(13px, 3vw, 15px);
        }

        /* ===== RECORD INFO ===== */
        .record-info {
            background: var(--light-blue);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            border-left: 4px solid var(--primary-blue);
        }

        .record-info h4 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            background: white;
            padding: 12px;
            border-radius: var(--radius);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .info-label {
            font-size: 12px;
            color: var(--medium-gray);
            text-transform: uppercase;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .info-value {
            font-size: 14px;
            color: var(--dark-gray);
            font-weight: 500;
        }

        /* ===== FORM STYLES ===== */
        .edit-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark-gray);
            font-weight: 500;
            font-size: clamp(13px, 3vw, 14px);
        }

        .form-group label::after {
            content: ' *';
            color: var(--danger);
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-size: clamp(14px, 3.5vw, 16px);
            transition: var(--transition);
            background: #fafafa;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0,102,204,0.1);
            background: white;
            cursor: text;
        }

        .form-control:read-only {
            background-color: #f5f5f5;
            cursor: pointer;
            border-color: #ddd;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
            padding-right: 45px;
        }

        /* Enhanced dropdown styling */
        .select-wrapper {
            position: relative;
            width: 100%;
            cursor: pointer;
        }

        .custom-arrow {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #666;
            font-size: 12px;
            transition: var(--transition);
            z-index: 2;
        }

        /* Special hover effects for dropdowns */
        select.form-control:hover {
            border-color: var(--primary-blue);
            background-color: #f0f8ff;
        }

        select.form-control:hover ~ .custom-arrow {
            color: var(--primary-blue);
        }

        /* Active state */
        select.form-control:focus ~ .custom-arrow {
            transform: translateY(-50%) rotate(180deg);
            color: var(--primary-blue);
        }

        /* Style for options in dropdown */
        select.form-control option {
            cursor: pointer;
            padding: 12px 15px;
            background: white;
        }

        /* Hover effect for options */
        select.form-control option:hover,
        select.form-control option:focus {
            background-color: var(--light-blue);
            color: var(--dark-gray);
        }

        /* Active/selected option */
        select.form-control option:checked {
            background-color: var(--primary-blue);
            color: white;
        }

        /* Disabled option */
        select.form-control option:disabled {
            color: #999;
            background-color: #f5f5f5;
            cursor: not-allowed;
        }

        /* Change cursor to pointer for all select tags */
        select {
            cursor: pointer;
        }

        /* ===== BUTTONS ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: clamp(14px, 3.5vw, 16px);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-family: 'Poppins', sans-serif;
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--medium-gray) 0%, var(--dark-gray) 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--dark-gray) 0%, #222 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #e0a800 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        /* ===== FORM ACTIONS ===== */
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* ===== ERROR MESSAGES ===== */
        .error-message {
            color: var(--danger);
            font-size: clamp(11px, 2.5vw, 12px);
            margin-top: 5px;
            animation: fadeIn 0.3s ease;
            display: none;
        }

        .form-control.error {
            border-color: var(--danger);
        }

        .form-control.success {
            border-color: var(--success);
        }

        /* ===== LOADING OVERLAY ===== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            display: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: var(--dark-gray);
            font-size: 18px;
            font-weight: 600;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ===== ANIMATIONS ===== */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .nav-menu {
                width: 100%;
                left: -100%;
            }
            
            .edit-form {
                grid-template-columns: 1fr;
            }
            
            .form-container {
                padding: 25px;
            }
            
            .main-content {
                padding: 25px 15px;
            }
            
            .form-header h2 {
                font-size: 20px;
                flex-direction: column;
                gap: 5px;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
            }
            
            .flash-messages {
                top: 80px;
                right: 15px;
                left: 15px;
            }
            
            .flash {
                min-width: auto;
                width: 100%;
                padding: 12px 15px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 20px 10px;
            }
            
            .form-container {
                padding: 20px 15px;
                border-radius: 0;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .welcome-message {
                flex: 1;
                min-width: 0;
            }
            
            .welcome-message h1,
            .welcome-message p {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .form-control {
                padding: 10px 12px;
                font-size: 16px;
            }
            
            .btn {
                padding: 10px 20px;
            }
            
            .record-info {
                padding: 15px;
            }
        }

        @media (max-width: 320px) {
            .form-container {
                padding: 15px 10px;
            }
            
            .btn {
                font-size: 14px;
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="flash-messages"></div>
    <div class="menu-overlay"></div>

    <div class="dashboard-container">
        <header class="header">
            <div class="container header-content">
                <div class="welcome-message">
                    <h1>Edit Record #{{ record.id }}</h1>
                    <p>{{ campus }} - Update laptop movement details</p>
                </div>
                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <nav class="nav-menu">
            <div class="menu-header">
                <h3><i class="fas fa-university"></i> {{ campus }}</h3>
                <p>Logged in as: {{ session.username }}</p>
            </div>
            
            <div class="menu-items">
                <a href="{{ url_for('dashboard') }}" class="menu-item">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="{{ url_for('add_record') }}" class="menu-item">
                    <i class="fas fa-plus-circle"></i> Add New Record
                </a>
                <a href="{{ url_for('search_record') }}" class="menu-item">
                    <i class="fas fa-search"></i> Search Record
                </a>
                <a href="{{ url_for('calendar_report') }}" class="menu-item">
                    <i class="fas fa-calendar-alt"></i> Calendar Report
                </a>
            </div>
            
            <div class="menu-footer">
                <a href="{{ url_for('logout') }}" class="menu-item">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </nav>

        <main class="main-content container">
            <div class="form-container fade-in">
                <div class="form-header">
                    <h2><i class="fas fa-edit"></i> Edit Laptop Record</h2>
                    <p>Update the details for record #{{ record.id }}</p>
                </div>
                
                <div class="record-info">
                    <h4><i class="fas fa-info-circle"></i> Record Information</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">Original Date</div>
                            <div class="info-value">
                                {% if record.date_time is string %}
                                    {{ record.date_time[:16] }}
                                {% else %}
                                    {{ record.date_time.strftime('%Y-%m-%d %H:%M') }}
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Recorded By</div>
                            <div class="info-value">{{ record.recorded_by }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Current Direction</div>
                            <div class="info-value">{{ record.direction }}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">Campus</div>
                            <div class="info-value">{{ record.campus }}</div>
                        </div>
                    </div>
                </div>
                
                <form method="POST" action="{{ url_for('edit_record', record_id=record.id) }}" class="edit-form" id="editForm">
                    <!-- Row 1 -->
                    <div class="form-group">
                        <label for="student_names">Student Full Names</label>
                        <input type="text" 
                               class="form-control" 
                               id="student_names" 
                               name="student_names" 
                               value="{{ record.student_names }}" 
                               required>
                        <div class="error-message" id="student_names-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="registration_number">Registration Number</label>
                        <input type="text" 
                               class="form-control" 
                               id="registration_number" 
                               name="registration_number" 
                               value="{{ record.registration_number }}" 
                               required>
                        <div class="error-message" id="registration_number-error"></div>
                    </div>
                    
                    <!-- Row 2 -->
                    <div class="form-group">
                        <label for="telephone">Telephone Number</label>
                        <input type="tel" 
                               class="form-control" 
                               id="telephone" 
                               name="telephone" 
                               value="{{ record.telephone }}" 
                               required pattern="[0-9]{10,15}">
                        <div class="error-message" id="telephone-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="college">College</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="college" name="college" required>
                                <option value="">Select College</option>
                                <option value="College of Agriculture, Forestry and Food Science (CAFF)" {% if record.college == 'College of Agriculture, Forestry and Food Science (CAFF)' %}selected{% endif %}>College of Agriculture, Forestry and Food Science (CAFF)</option>
                                <option value="College of Arts and Social Sciences (CASS)" {% if record.college == 'College of Arts and Social Sciences (CASS)' %}selected{% endif %}>College of Arts and Social Sciences (CASS)</option>
                                <option value="College of Business and Economics (CBE)" {% if record.college == 'College of Business and Economics (CBE)' %}selected{% endif %}>College of Business and Economics (CBE)</option>
                                <option value="College of Medicine and Health Sciences (CMHS)" {% if record.college == 'College of Medicine and Health Sciences (CMHS)' %}selected{% endif %}>College of Medicine and Health Sciences (CMHS)</option>
                                <option value="College of Education (CE)" {% if record.college == 'College of Education (CE)' %}selected{% endif %}>College of Education (CE)</option>
                                <option value="College of Science and Technology (CST)" {% if record.college == 'College of Science and Technology (CST)' %}selected{% endif %}>College of Science and Technology (CST)</option>
                                <option value="College of Agriculture, Animal Sciences and Veterinary Medicine (CAVM)" {% if record.college == 'College of Agriculture, Animal Sciences and Veterinary Medicine (CAVM)' %}selected{% endif %}>College of Agriculture, Animal Sciences and Veterinary Medicine (CAVM)</option>
                                <option value="Other" {% if record.college == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="college-error"></div>
                    </div>
                    
                    <!-- Row 3 -->
                    <div class="form-group">
                        <label for="school">School/Department</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="school" name="school" required disabled>
                                <option value="">Select College First</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="school-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="department">Department</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="department" name="department" required disabled>
                                <option value="">Select School First</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="department-error"></div>
                    </div>
                    
                    <!-- Row 4 -->
                    <div class="form-group">
                        <label for="year_of_study">Year of Study</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="year_of_study" name="year_of_study" required>
                                <option value="">Select Year</option>
                                <option value="Year 1" {% if record.year_of_study == 'Year 1' %}selected{% endif %}>Year 1</option>
                                <option value="Year 2" {% if record.year_of_study == 'Year 2' %}selected{% endif %}>Year 2</option>
                                <option value="Year 3" {% if record.year_of_study == 'Year 3' %}selected{% endif %}>Year 3</option>
                                <option value="Year 4" {% if record.year_of_study == 'Year 4' %}selected{% endif %}>Year 4</option>
                                <option value="Year 5" {% if record.year_of_study == 'Year 5' %}selected{% endif %}>Year 5</option>
                                <option value="Postgraduate" {% if record.year_of_study == 'Postgraduate' %}selected{% endif %}>Postgraduate</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="year-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="laptop_type">Laptop Type (Brand/Model)</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="laptop_type" name="laptop_type" required>
                                <option value="">Select Laptop Type</option>
                                <option value="HP" {% if record.laptop_type == 'HP' %}selected{% endif %}>HP</option>
                                <option value="Dell" {% if record.laptop_type == 'Dell' %}selected{% endif %}>Dell</option>
                                <option value="Lenovo" {% if record.laptop_type == 'Lenovo' %}selected{% endif %}>Lenovo</option>
                                <option value="Apple MacBook" {% if record.laptop_type == 'Apple MacBook' %}selected{% endif %}>Apple MacBook</option>
                                <option value="Acer" {% if record.laptop_type == 'Acer' %}selected{% endif %}>Acer</option>
                                <option value="Asus" {% if record.laptop_type == 'Asus' %}selected{% endif %}>Asus</option>
                                <option value="Toshiba" {% if record.laptop_type == 'Toshiba' %}selected{% endif %}>Toshiba</option>
                                <option value="Samsung" {% if record.laptop_type == 'Samsung' %}selected{% endif %}>Samsung</option>
                                <option value="Microsoft Surface" {% if record.laptop_type == 'Microsoft Surface' %}selected{% endif %}>Microsoft Surface</option>
                                <option value="Other" {% if record.laptop_type == 'Other' %}selected{% endif %}>Other</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="laptop-error"></div>
                    </div>
                    
                    <!-- Row 5 -->
                    <div class="form-group">
                        <label for="serial_number">Laptop Serial Number</label>
                        <input type="text" 
                               class="form-control" 
                               id="serial_number" 
                               name="serial_number" 
                               value="{{ record.serial_number }}" 
                               required>
                        <div class="error-message" id="serial-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="direction">Direction</label>
                        <div class="select-wrapper">
                            <select class="form-control" id="direction" name="direction" required>
                                <option value="">Select Direction</option>
                                <option value="IN" {% if record.direction == 'IN' %}selected{% endif %}>IN (Entering Campus)</option>
                                <option value="OUT" {% if record.direction == 'OUT' %}selected{% endif %}>OUT (Leaving Campus)</option>
                            </select>
                            <div class="custom-arrow">â–¼</div>
                        </div>
                        <div class="error-message" id="direction-error"></div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Update Record
                        </button>
                        <a href="{{ url_for('view_record', record_id=record.id) }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <a href="{{ url_for('search_record') }}" class="btn">
                            <i class="fas fa-arrow-left"></i> Back to Search
                        </a>
                    </div>
                </form>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: var(--radius); margin-top: 20px; font-size: 14px; color: var(--medium-gray);">
                <p><i class="fas fa-info-circle"></i> <strong>Note:</strong> All fields marked with * are required. The record will be updated with your username ({{ session.username }}) as the editor.</p>
            </div>
        </main>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Updating Record...</div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Menu toggle functionality
            const menuToggle = document.querySelector('.menu-toggle');
            const navMenu = document.querySelector('.nav-menu');
            const menuOverlay = document.querySelector('.menu-overlay');
            
            function toggleMenu() {
                navMenu.classList.toggle('active');
                if (navMenu.classList.contains('active')) {
                    menuOverlay.style.display = 'block';
                    setTimeout(() => menuOverlay.style.opacity = '1', 10);
                } else {
                    menuOverlay.style.opacity = '0';
                    setTimeout(() => menuOverlay.style.display = 'none', 300);
                }
            }
            
            function closeMenu() {
                navMenu.classList.remove('active');
                menuOverlay.style.opacity = '0';
                setTimeout(() => menuOverlay.style.display = 'none', 300);
            }
            
            if (menuToggle) {
                menuToggle.addEventListener('click', toggleMenu);
                menuOverlay.addEventListener('click', closeMenu);
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && navMenu.classList.contains('active')) closeMenu();
                });
            }
            
            // Data structure for hierarchical dropdowns
            const collegeData = {
                "College of Agriculture, Forestry and Food Science (CAFF)": {
                    "School of Agricultural Engineering": [
                        "Irrigation and Drainage",
                        "Agricultural Mechanization",
                        "Forestry and Nature Conservation"
                    ],
                    "School of Agriculture and Food Sciences": [
                        "Crop Sciences",
                        "Soil Sciences",
                        "Rural Development & Agricultural Economics (RDAE)",
                        "Food Science & Technology (FST)"
                    ],
                    "School of Forestry, Ecotourism, and Greenspace Management": [
                        "Forestry & Landscape Management",
                        "Ecotourism and Green Space Management"
                    ]
                },
                "College of Arts and Social Sciences (CASS)": {
                    "School of Arts and Languages": [
                        "Modern Languages"
                    ],
                    "School of Law": [
                        "Public Law",
                        "Private Law"
                    ],
                    "School of Governance": [
                        "Governance and Public Administration",
                        "Political Science and International Relations",
                        "Social Sciences",
                        "Professional Police Studies",
                        "Social and Military Sciences",
                        "Development Studies",
                        "History and Heritage Studies"
                    ],
                    "School of Journalism and Communication": [
                        "Journalism and Communication"
                    ]
                },
                "College of Business and Economics (CBE)": {
                    "School of Business": [
                        "Department of Finance",
                        "Department of Marketing and Human Resources",
                        "Department of Banking and Insurance",
                        "Department of Procurement, Logistics and Transport Management",
                        "Department of Accounting",
                        "Department of Business Information Technology"
                    ],
                    "School of Economics": [
                        "Department of Economics",
                        "Department of Applied Statistics"
                    ]
                },
                "College of Medicine and Health Sciences (CMHS)": {
                    "School of Dentistry": [
                        "Bachelor of Science with Honours in Dental Therapy",
                        "Bachelor of Dental Surgery"
                    ],
                    "School of Medicine and Pharmacy": [
                        "General Medicine",
                        "Clinical Psychology",
                        "Pharmacy"
                    ],
                    "School of Nursing and Midwifery": [
                        "General Nursing",
                        "Midwifery",
                        "Mental Health Nursing"
                    ],
                    "School of Public Health": [
                        "Human Nutrition and Dietetics",
                        "Environmental Health Sciences"
                    ],
                    "School of Health Sciences": [
                        "Physiotherapy",
                        "Anaesthesia",
                        "Ophthalmology",
                        "Prosthetics and Orthotics",
                        "Medical Imaging Sciences",
                        "Biomedical Laboratory Sciences",
                        "Clinical Medicine and Community Health",
                        "Occupational Therapy"
                    ]
                },
                "College of Education (CE)": {
                    "School of Education": [
                        "Department of Humanities, Arts and Languages Education",
                        "Department of Early Childhood and Primary Education",
                        "Department of Foundations, Management and Curriculum Studies",
                        "Department of Mathematics, Sciences and Physical Education"
                    ],
                    "School of Inclusive and Special Needs Education": [
                        "Inclusive and Special Needs Education"
                    ]
                },
                "College of Science and Technology (CST)": {
                    "School of Architecture and Built Environment": [
                        "Department of Construction Management",
                        "Department of Estate Management and Valuation",
                        "Department of Geography and Urban Planning",
                        "Department of Architecture"
                    ],
                    "School of Engineering": [
                        "Department of Building and Construction Technology",
                        "Department of Civil Environmental and Geomatic Engineering (CEGE)",
                        "Department of Electrical Engineering",
                        "Department of Electronics and Telecommunication Engineering",
                        "Department of Mechanical Engineering",
                        "Department of Surveying and Geomatic Engineering",
                        "Department of Water and Environmental Engineering"
                    ],
                    "School of ICT": [
                        "Department of Computer and Software Engineering",
                        "Information Technology",
                        "Information Systems",
                        "Computer Science"
                    ],
                    "School of Mining and Geology": [
                        "Department of Geology",
                        "Department of Mining Engineering"
                    ],
                    "School of Science": [
                        "Department of Biology",
                        "Department of Chemistry",
                        "Department of Mathematics",
                        "Department of Physics"
                    ]
                },
                "College of Agriculture, Animal Sciences and Veterinary Medicine (CAVM)": {
                    "School of Agricultural Engineering and Environmental Management": [
                        "Agriculture Mechanization",
                        "Irrigation and Drainage",
                        "Forestry and Nature Conservation"
                    ],
                    "School of Animal Sciences and Veterinary Medicine": [
                        "Animal Production",
                        "Veterinary Medicine",
                        "Wildlife and Aquatic Resources Management"
                    ],
                    "School of Food Science and Technology": [
                        "Food Science and Technology"
                    ],
                    "School of Agriculture, Rural Development and Agricultural Economics": [
                        "Crop Sciences",
                        "Soil Sciences",
                        "Agriculture Economics and Rural Development"
                    ]
                }
            };
            
            // Get dropdown elements
            const collegeSelect = document.getElementById('college');
            const schoolSelect = document.getElementById('school');
            const departmentSelect = document.getElementById('department');
            const laptopTypeSelect = document.getElementById('laptop_type');
            
            // Initialize form with existing record values
            function initializeForm() {
                const recordCollege = "{{ record.college }}";
                const recordSchool = "{{ record.school }}";
                const recordDepartment = "{{ record.department }}";
                
                // If college is selected from record, populate schools
                if (recordCollege) {
                    // Enable school select
                    schoolSelect.disabled = false;
                    schoolSelect.innerHTML = '<option value="">Select School</option>';
                    
                    // Populate schools based on college
                    if (collegeData[recordCollege]) {
                        for (const school in collegeData[recordCollege]) {
                            const option = document.createElement('option');
                            option.value = school;
                            option.textContent = school;
                            option.selected = (school === recordSchool);
                            schoolSelect.appendChild(option);
                        }
                        
                        // Add Other option
                        const otherOption = document.createElement('option');
                        otherOption.value = 'Other';
                        otherOption.textContent = 'Other';
                        otherOption.selected = (recordSchool === 'Other');
                        schoolSelect.appendChild(otherOption);
                    }
                    
                    // If school is selected, populate departments
                    if (recordSchool && recordSchool !== 'Other') {
                        departmentSelect.disabled = false;
                        departmentSelect.innerHTML = '<option value="">Select Department</option>';
                        
                        if (collegeData[recordCollege] && collegeData[recordCollege][recordSchool]) {
                            collegeData[recordCollege][recordSchool].forEach(department => {
                                const option = document.createElement('option');
                                option.value = department;
                                option.textContent = department;
                                option.selected = (department === recordDepartment);
                                departmentSelect.appendChild(option);
                            });
                            
                            // Add Other option
                            const otherOption = document.createElement('option');
                            otherOption.value = 'Other';
                            otherOption.textContent = 'Other';
                            otherOption.selected = (recordDepartment === 'Other');
                            departmentSelect.appendChild(otherOption);
                        }
                    } else if (recordSchool === 'Other') {
                        departmentSelect.disabled = false;
                        departmentSelect.innerHTML = '<option value="">Specify Department</option>';
                        
                        const otherOption = document.createElement('option');
                        otherOption.value = 'Other';
                        otherOption.textContent = 'Other';
                        otherOption.selected = (recordDepartment === 'Other');
                        departmentSelect.appendChild(otherOption);
                    }
                }
            }
            
            // Initialize the form
            initializeForm();
            
            // College change event
            collegeSelect.addEventListener('change', function() {
                const selectedCollege = this.value;
                
                // Reset school and department
                schoolSelect.innerHTML = '<option value="">Select School</option>';
                departmentSelect.innerHTML = '<option value="">Select Department</option>';
                
                // Enable/disable based on selection
                if (selectedCollege && selectedCollege !== 'Other') {
                    schoolSelect.disabled = false;
                    departmentSelect.disabled = true;
                    
                    // Populate schools
                    if (collegeData[selectedCollege]) {
                        for (const school in collegeData[selectedCollege]) {
                            const option = document.createElement('option');
                            option.value = school;
                            option.textContent = school;
                            schoolSelect.appendChild(option);
                        }
                        
                        // Add Other option
                        const otherOption = document.createElement('option');
                        otherOption.value = 'Other';
                        otherOption.textContent = 'Other';
                        schoolSelect.appendChild(otherOption);
                    }
                } else if (selectedCollege === 'Other') {
                    // Handle Other college
                    schoolSelect.disabled = false;
                    departmentSelect.disabled = false;
                    schoolSelect.innerHTML = '<option value="">Specify School</option>';
                    departmentSelect.innerHTML = '<option value="">Specify Department</option>';
                    
                    const otherSchoolOption = document.createElement('option');
                    otherSchoolOption.value = 'Other';
                    otherSchoolOption.textContent = 'Other';
                    schoolSelect.appendChild(otherSchoolOption);
                    
                    const otherDeptOption = document.createElement('option');
                    otherDeptOption.value = 'Other';
                    otherDeptOption.textContent = 'Other';
                    departmentSelect.appendChild(otherDeptOption);
                } else {
                    schoolSelect.disabled = true;
                    departmentSelect.disabled = true;
                    schoolSelect.innerHTML = '<option value="">Select College First</option>';
                    departmentSelect.innerHTML = '<option value="">Select School First</option>';
                }
            });
            
            // School change event
            schoolSelect.addEventListener('change', function() {
                const selectedCollege = collegeSelect.value;
                const selectedSchool = this.value;
                
                // Reset department
                departmentSelect.innerHTML = '<option value="">Select Department</option>';
                
                if (selectedSchool && selectedSchool !== 'Other' && selectedCollege && selectedCollege !== 'Other') {
                    departmentSelect.disabled = false;
                    
                    // Populate departments
                    if (collegeData[selectedCollege] && collegeData[selectedCollege][selectedSchool]) {
                        collegeData[selectedCollege][selectedSchool].forEach(department => {
                            const option = document.createElement('option');
                            option.value = department;
                            option.textContent = department;
                            departmentSelect.appendChild(option);
                        });
                        
                        // Add Other option
                        const otherOption = document.createElement('option');
                        otherOption.value = 'Other';
                        otherOption.textContent = 'Other';
                        departmentSelect.appendChild(otherOption);
                    }
                } else if (selectedSchool === 'Other') {
                    departmentSelect.disabled = false;
                    departmentSelect.innerHTML = '<option value="">Specify Department</option>';
                    
                    const otherOption = document.createElement('option');
                    otherOption.value = 'Other';
                    otherOption.textContent = 'Other';
                    departmentSelect.appendChild(otherOption);
                } else {
                    departmentSelect.disabled = true;
                    departmentSelect.innerHTML = '<option value="">Select School First</option>';
                }
            });
            
            // Create input fields for "Other" options
            function createOtherInput(selectId, placeholder) {
                const select = document.getElementById(selectId);
                const container = select.parentElement.parentElement;
                
                const otherInput = document.createElement('input');
                otherInput.type = 'text';
                otherInput.className = 'form-control mt-2';
                otherInput.placeholder = placeholder;
                otherInput.style.display = 'none';
                otherInput.id = selectId + '_other';
                otherInput.name = selectId + '_other';
                
                // Check if current value is "Other"
                if (select.value === 'Other') {
                    otherInput.style.display = 'block';
                    otherInput.required = true;
                }
                
                container.appendChild(otherInput);
                
                select.addEventListener('change', function() {
                    if (this.value === 'Other') {
                        otherInput.style.display = 'block';
                        otherInput.required = true;
                    } else {
                        otherInput.style.display = 'none';
                        otherInput.required = false;
                        otherInput.value = '';
                    }
                });
            }
            
            // Initialize other inputs
            createOtherInput('college', 'Please specify college');
            createOtherInput('school', 'Please specify school/department');
            createOtherInput('department', 'Please specify department');
            createOtherInput('laptop_type', 'Please specify laptop brand/model');
            
            // Form submission handler
            const form = document.getElementById('editForm');
            const telInput = document.getElementById('telephone');
            
            if (telInput) {
                telInput.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }
            
            // Form submission with loading
            form.addEventListener('submit', function(e) {
                // Update values for "Other" selections before submission
                const selects = ['college', 'school', 'department', 'laptop_type'];
                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select.value === 'Other') {
                        const otherInput = document.getElementById(selectId + '_other');
                        if (otherInput && otherInput.value.trim()) {
                            select.value = otherInput.value.trim();
                        }
                    }
                });
                
                // Show loading overlay
                document.querySelector('.loading-overlay').style.display = 'flex';
                
                // Validate form
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;
                
                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        isValid = false;
                        field.classList.add('error');
                        const errorId = field.id + '-error';
                        const errorEl = document.getElementById(errorId);
                        if (errorEl) {
                            errorEl.textContent = 'This field is required';
                            errorEl.style.display = 'block';
                        }
                    } else {
                        field.classList.remove('error');
                        const errorId = field.id + '-error';
                        const errorEl = document.getElementById(errorId);
                        if (errorEl) {
                            errorEl.style.display = 'none';
                        }
                    }
                });
                
                // Validate telephone
                if (telInput && !/^\d{10,15}$/.test(telInput.value)) {
                    isValid = false;
                    telInput.classList.add('error');
                    const errorEl = document.getElementById('telephone-error');
                    if (errorEl) {
                        errorEl.textContent = 'Please enter a valid phone number (10-15 digits)';
                        errorEl.style.display = 'block';
                    }
                }
                
                if (!isValid) {
                    e.preventDefault();
                    document.querySelector('.loading-overlay').style.display = 'none';
                    showNotification('Please fix the errors in the form.', 'danger');
                }
            });
            
            // Enhanced dropdown arrow animation
            const selectWrappers = document.querySelectorAll('.select-wrapper');
            selectWrappers.forEach(wrapper => {
                const select = wrapper.querySelector('select');
                const arrow = wrapper.querySelector('.custom-arrow');
                
                if (select && arrow) {
                    select.addEventListener('focus', function() {
                        arrow.style.transform = 'translateY(-50%) rotate(180deg)';
                        arrow.style.color = 'var(--primary-blue)';
                    });
                    
                    select.addEventListener('blur', function() {
                        arrow.style.transform = 'translateY(-50%)';
                        arrow.style.color = '#666';
                    });
                    
                    select.addEventListener('mouseenter', function() {
                        if (document.activeElement !== select) {
                            arrow.style.color = 'var(--primary-blue)';
                        }
                    });
                    
                    select.addEventListener('mouseleave', function() {
                        if (document.activeElement !== select) {
                            arrow.style.color = '#666';
                        }
                    });
                }
            });
            
            // Flash message functionality
            window.showNotification = function(message, type = 'info') {
                const flashContainer = document.querySelector('.flash-messages');
                const flash = document.createElement('div');
                flash.className = `flash ${type}`;
                flash.innerHTML = `<span>${message}</span><button><i class="fas fa-times"></i></button>`;
                flashContainer.appendChild(flash);
                
                flash.querySelector('button').addEventListener('click', function() {
                    flash.style.opacity = '0';
                    flash.style.transform = 'translateX(100%)';
                    setTimeout(() => flash.remove(), 300);
                });
                
                setTimeout(() => {
                    if (flash.parentNode) {
                        flash.style.opacity = '0';
                        flash.style.transform = 'translateX(100%)';
                        setTimeout(() => flash.parentNode && flash.remove(), 300);
                    }
                }, 5000);
            };
            
            // Auto-focus first field
            setTimeout(() => document.getElementById('student_names').focus(), 500);
            
            // Check for existing flash messages
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        window.showNotification('{{ message }}', '{{ category }}');
                    {% endfor %}
                {% endif %}
            {% endwith %}
        });
    </script>
</body>
</html>